<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Flaskå­¦ä¹ ç¬”è®°:Requestå’ŒResponse]]></title>
    <url>%2F2018%2F06%2F01%2FFlask%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Request%E5%92%8CResponse%2F</url>
    <content type="text"><![CDATA[Request:HTTPç¼–ç æ ¼å¼ä»Ž request å¯¹è±¡ä¸­èŽ·å–POSTè¯·æ±‚å‚æ•°12345@app.route('/app/login',methods = ['POST'])def app_login(): if request.method == 'POST': username = request.form.get('username') password = request.form.get('password') JSONç¼–ç æ ¼å¼12345@app.route('/app/login',methods = ['POST'])def app_login(): if request.method == 'POST': username = request.get_json().get('username') password = request.get_json().get('password') ResponseJSONç¼–ç æ ¼å¼1# return json.jsonify(dict/list/tuple) å¦å¤–,é€šè¿‡è‡ªå®šä¹‰å“åº”ç±», è¿˜å¯ä»¥å°†ä¸€äº›ç¹ççš„ä»»åŠ¡ç®€å•åŒ–æ­¤å¤„å‚è€ƒæ–‡ç« : å¦‚ä½•è‡ªå®šä¹‰Flaskä¸­çš„å“åº”ç±»ï¼ˆè¯‘æ–‡ï¼‰ ä»¥åŠ Flaskè®¾ç½®è¿”å›žjsonæ ¼å¼æ•°æ®è‡ªå®šä¹‰ response ç±»1234567from flask import Flask, Responseclass MyResponse(Response): # å®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ªResponseçš„å¯¹è±¡ passapp = Flask(__name__)app.response_class = MyResponse # å‘Šè¯‰ app ä½ è‡ªå®šä¹‰çš„ response ç±»åž‹ å¦‚æžœç›´æŽ¥åœ¨è¿”å›žå“åº”ä½“ä¸­ä¼ å…¥ dict/list ç­‰å†…å®¹, Response æ˜¯æ— æ³•è§£æžçš„123return Response(dict(abc='abc', def='def'))# ä»¥ä¸Šè¿™æ ·è¿”å›žå“åº”ä½“æ˜¯ä¼šæŠ¥é”™çš„:TypeError: 'dict' object is not callable åˆ©ç”¨è‡ªå®šä¹‰çš„ response ç±», å®žçŽ°è‡ªåŠ¨è¿”å›ž JSON å“åº”ä½“Response()ä¼ å…¥çš„å‚æ•°ä¸­, æ‰€æœ‰ä¸èƒ½å¤„ç†çš„æ•°æ®ï¼Œéƒ½ç”± force_type() æ–¹æ³•å°è¯•å¤„ç†åŽï¼Œå†å†³å®šæŠ¥é”™æˆ–é€šè¿‡ã€‚123456class MyResponse(Response): @classmethod # é‡å†™ force_type() ç±»æ–¹æ³•, æ‹¦æˆªå¹¶åˆ¤æ–­æŠ¥é”™çš„å‚æ•°ç±»åž‹ def force_type(cls, rv, environ=None): if isinstance(rv, dict): rv = jsonify(rv) return super(MyResponse, cls).force_type(rv, environ)]]></content>
      <tags>
        <tag>python</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®°å½•ä¸€ä¸‹ffmpegçš„é™æ€ç¼–è¯‘ä»¥åŠå¦‚ä½•åœ¨é¡¹ç›®ä¸­ä»¥å•è¿›ç¨‹å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œffmpegå‘½ä»¤]]></title>
    <url>%2F2018%2F05%2F30%2F%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8Bffmpeg%E7%9A%84%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BB%A5%E5%8D%95%E8%BF%9B%E7%A8%8B%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E6%89%A7%E8%A1%8Cffmpeg%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[ä¸Šä¸€ç¯‡æ–‡ç« ä¹Ÿæœ‰æåˆ°, å°†åŠ¨æ€åº“åŠ å…¥åˆ°é¡¹ç›®ä¸­ä½¿ç”¨å®žåœ¨å¹¶ä¸æ˜¯ä¸Šç­–, æ‰€ä»¥æœ‰äº†è¿™ä¸ªé™æ€åº“ç¼–è¯‘å¹¶åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„å®žè·µè®°å½•.å¯èƒ½ç½‘ä¸Šå¾ˆå¤šåœ°æ–¹éƒ½æœ‰ç›¸ä¼¼çš„æ•™ç¨‹å’Œè¯´æ˜Ž, æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘æ‰“ç®—å°½å¯èƒ½è¯´ä¸€äº›åˆ«äººæ²¡è¯´è¿‡çš„.(å…¶å®žæ˜¯æˆ‘æ‰¾ä¸åˆ°çš„ðŸ˜‚) å¼€å§‹ä¹‹å‰è¯´æ˜Žä¸€ä¸‹ä¸ºä»€ä¹ˆæˆ‘è®¤ä¸ºå°†ffmpegç¼–è¯‘çš„åŠ¨æ€åº“åŠ å…¥åˆ°é¡¹ç›®ä¸­å¹¶ä¸æ˜¯ä¸Šç­–: åŒ…ä¼šç›¸å¯¹çš„å¤§. å¦‚ä¸Šä¸€ç¯‡æ‰€è¯´, è¦å¯¹ç¼–è¯‘å‡ºæ¥çš„å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œé‡å®šå‘ rpath æ“ä½œ. åŠ¨æ€åŒ…å¤ªå¤šå¯¼è‡´è¿‡ç¨‹å¤ªè¿‡ç¹ç. ç”±äºŽæˆ‘çš„éœ€æ±‚ä¸»è¦æ˜¯ä»¥ ffmpeg åšè½¬æ¢æ“ä½œ, å¸Œæœ›å¯ä»¥åœ¨ç•Œé¢ä¸Šå®žæ—¶åœ°çœ‹åˆ°è½¬æ¢è¿‡ç¨‹, æ˜¯å¦å‡ºé”™, å¯ä»¥å¥½åƒä½¿ç”¨ Terminal ä¸€æ ·, å¯¹é”™è¯¯çš„è¡Œæœ‰é’ˆå¯¹æ€§çš„é¢œè‰²æ˜¾ç¤º. å¦‚å›¾ è€Œå¦‚æžœä½¿ç”¨ NSTask æ‰§è¡Œ ffmpeg, æˆ‘å¹¶ä¸èƒ½é€šè¿‡ NSTask å‡†ç¡®åœ°æ•èŽ·åˆ° ffmpeg æ‰§è¡ŒæœŸé—´æ¯è¡Œè¾“å‡ºå‘½ä»¤çš„level.è¿™é‡Œè¯´çš„ level æ˜¯ ffmpeg ä¸­ libavutil/log.h ä¸­å®šä¹‰çš„ä¸€ç³»åˆ—å®å®šä¹‰, åŒ…æ‹¬ AV_LOG_ERROR, AV_LOG_WARNING, AV_LOG_VERBOSE ç­‰ç­‰.è€Œå¦‚æžœæˆ‘ç›´æŽ¥ç”¨ ffmpeg.c ä¸­çš„ main() å‡½æ•°æ‰§è¡Œ ffmpeg å‘½ä»¤, æˆ‘ä¸ä»…å¯ä»¥å‡†ç¡®åœ°æ•èŽ·æ¯è¡Œè¾“å‡ºçš„ level, è¿˜å¯ä»¥é€šè¿‡ main() å‡½æ•°çš„è¿”å›ž, åˆ¤æ–­åˆ°æ•´ä¸ªè¿‡ç¨‹æ˜¯å¦é¡ºåˆ©å®Œæˆ. A.ç¼–è¯‘è¿‡ç¨‹ä¸å†èµ˜è¿°, å€¼å¾—æ³¨æ„çš„æ˜¯ç¼–è¯‘çš„é…ç½®1--prefix=/Users/username/targetPath --disable-doc --enable-pic --enable-cross-compile --enable-pthreads --enable-version3 --enable-nonfree --disable-shared --enable-static --enable-hardcoded-tables --cc=clang --host-cflags= --host-ldflags= --enable-gpl --enable-libfdk-aac --enable-libmp3lame --enable-libx264 --enable-libx265 --enable-libxvid --enable-opencl --enable-videotoolbox --enable-audiotoolbox --disable-lzma å…¶ä¸­ --disable-shared å’Œ --enable-static åˆ†åˆ«æ˜¯æŒ‡: ä¸ç¼–è¯‘ä¸ºåŠ¨æ€åº“, ç¼–è¯‘ä¸ºé™æ€åº“ --disable-programs æ˜¯æŒ‡ä¸ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶(ffmpeg, ffprobe, ffplay ç­‰) B.å°†ç¼–è¯‘å‡ºæ¥çš„ä¸¤ä¸ªæ–‡ä»¶å¤¹, include,lib åŠ å…¥é¡¹ç›®, å¹¶åŠ å…¥ç›¸å…³ä¾èµ–åº“, ç¼–è¯‘é€šè¿‡.ç›¸å…³ä¾èµ–åº“å¦‚å›¾è¿™é‡Œè¦æ³¨æ„çš„æ˜¯, è®°å¾—åŠ å…¥ä½ éœ€è¦çš„ç¬¬ä¸‰æ–¹ä¾èµ–åº“, ä¸ç„¶ç¼–è¯‘ä¼šæŠ¥é”™, å°±å¦‚ä¸Šé¢ç¼–è¯‘é…ç½®ä¸­æˆ‘åŠ å…¥äº† --enable-libx265, é‚£ä¹ˆå°±åŽ»libx265çš„å¼€å‘å®˜ç½‘ä¸‹ä»–ä»¬çš„ libx265.a.ä¸è¿‡æˆ‘ä¸æ˜¯åŽ»ä»–ä»¬å®˜ç½‘ä¸‹è½½çš„, å“ˆå“ˆå“ˆå“ˆ, æˆ‘æ˜¯ç”¨çš„ homebrew åœ¨ç”µè„‘ä¸Šå¦å¤–è£…äº† ffmpeg, homebrew å°† ä¸‹è½½ffmpeg, ç¼–è¯‘ffmpeg, ä¸‹è½½ç›¸å…³ä¾èµ–åº“, æ­å»ºffmpegçŽ¯å¢ƒ å››å¤§å·¥ä½œéƒ½åšå¥½äº†, å¦‚æ— æ„å¤–å¯ä»¥åœ¨ /usr/local/Cellar æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°, æ‰¾åˆ°åŽå°†ç›¸å…³çš„ .a æ–‡ä»¶åŠ å…¥åˆ°é¡¹ç›®å³å¯. C.å°† ffmpeg æºä»£ç ä¸­çš„ fftools ä¸­ä»¥ä¸‹ä¸€å¨æ–‡ä»¶åŠ å…¥é¡¹ç›®: ffmpeg.c ffmpeg.h cmdutils.c cmdutils.h ffmpeg_cuvid.c ffmpeg_filter.code ffmpeg_hw.c ffmpeg_opt.c ffmpeg_videotoolbox.c ç¼–è¯‘, ç„¶åŽæ˜¯ä¸€å®šä¼šæŠ¥é”™çš„. å„ç§æ‰¾ä¸åˆ° #include &quot;è°è°è°&quot; , å¥½å¯æ€•å¯¹å§. è¿™äº›æŠ¥é”™çœŸæ˜¯æŠŠæˆ‘å“å°¿äº†, åŽæ¥æˆ‘å¤§æ¦‚æ˜¯åšäº†è¿™äº›äº‹: å°½å¯èƒ½ä¸å¯¹ æ‰¾ä¸åˆ°çš„ #include xxx åš æ³¨é‡Š/åˆ é™¤, å› ä¸ºå¯èƒ½ä¼šæ¶‰åŠæ›´å¤šä¾èµ–å®šä¹‰æ‰¾ä¸åˆ°, æ‰¾ä¸åˆ°çš„è¯å°±åŽ» ffmpeg çš„æºç ä¸­åŽ»æ‹‰å–.ä¾‹å¦‚ #include &quot;libavutil/thread&quot; è¯´æ‰¾ä¸åˆ°, é‚£å°±åŽ» ffmpeg æºç  ä¸­åŽ»æ‹‰. #include &quot;config.h&quot; æ–‡ä»¶æ‰¾ä¸åˆ°, æˆ‘å°±åŽ» ffmpeg æºç åŽ»æ‹‰, åæ­£æƒ³è¦çš„éƒ½åœ¨ ffmpeg çš„æºç é‡Œ.å¦‚å›¾ æˆ‘è¿˜è®°å¾—æˆ‘ç¼–è¯‘å‡ºæ¥çš„ lib æ–‡ä»¶å¤¹ä¸­å¹¶æ²¡æœ‰ libswresample ç›¸å…³çš„æ–‡ä»¶å¤¹, ä¹Ÿå°±æ˜¯æ„å‘³ç€, æˆ‘ç¼–è¯‘å‡ºæ¥è¦ç”¨çš„åŠŸèƒ½æ˜¯ç”¨ä¸ç€ libswresample è¿™ä¸ªæ¨¡å—å†…å®¹çš„, é‚£ä¹ˆæˆ‘å°±ç›´æŽ¥æŠŠæ‰€æœ‰è¯´æ‰¾ä¸åˆ° #include &quot;libswresample/xxxx&quot; çš„éƒ½ æ³¨é‡Š/åˆ é™¤ æŽ‰, ç”šè‡³å°†ä»£ç ä¸­å®žé™…ä½¿ç”¨åˆ°çš„ç›¸å…³æŠ¥é”™éƒ½æ³¨é‡ŠæŽ‰. åæ­£å¤§èƒ†æ“ä½œå°±å¯¹äº†. è¦ä¸å°±æ‹–åˆ°é¡¹ç›®, ä¸è¡Œå°±æ³¨é‡ŠæŽ‰. å¦‚æžœæœ€åŽä¸å†è·Ÿä½ è¯´æ‰¾ä¸åˆ° #include &quot;xxxxx&quot; äº†, åˆ°äº†é“¾æŽ¥é‚£ä¸€æ­¥å‡ºé”™, é‚£å‡ ä¹Ž 80% çš„æƒ…å†µæ˜¯å°‘äº†æŸäº›ä¾èµ–åº“.æˆ‘è®°å¾—åœ¨æˆ‘æ­¥éª¤ B ä¸­æ˜¯é¡ºåˆ©ç¼–è¯‘çš„, åˆ°äº†æ­¥éª¤ C, åŠ å…¥äº† fftools æ–‡ä»¶å¤¹ä»¥ä¸‹çš„é‚£å¨æ–‡ä»¶åŽ, åœ¨é“¾æŽ¥çŠ¶æ€ä¸­æŠ¥é”™, éšçº¦è®°å¾—æ˜¯ &quot;_clxxxxxx&quot; æ–¹æ³•æ‰¾ä¸åˆ°äº†, é‚£å°±åŠ å…¥äº† OpenCL.framework, å°±å¥½äº†. å¦‚æžœå„ç§åº“åŠ ä¸Šäº†, ç¼–è¯‘æ—¶ä¾ç„¶æ˜¯åœ¨é“¾æŽ¥çš„é‚£ä¸€æ­¥æœ‰é—®é¢˜, æˆ‘å·å·å‘Šè¯‰ä½ , ffmpeg.c ä¸­æœ‰ä¸ª main() å‡½æ•°, ä¸€ä¸ªé¡¹ç›®ä¸­(å¯æ‰§è¡Œæ–‡ä»¶)æœ‰ä¸”åªèƒ½å­˜åœ¨ä¸€ä¸ª main() å‡½æ•°. æŠŠ ffmpeg.c ä¸­çš„ mian() å‡½æ•°æ”¹å, ä¾‹å¦‚ ffmpeg_main() ä¹‹ç±»çš„. D.èµ°è¿‡äº†ABCåŽ, ç¼–è¯‘é¡ºåˆ©é€šè¿‡, å°±æ˜¯æˆåŠŸäº†ä¸€åŠäº†. æŽ¥ä¸‹æ¥å°±æ˜¯ç”¨ ffmpeg_main() å‡½æ•°æ‰§è¡Œå‘½ä»¤.1234567891011121314151617- (void)executeCommand:(NSArray&lt;NSString *&gt; *)commands&#123; int argc = (int)commands.count; char** argv=(char**)malloc(sizeof(char*)*argc); for(int i=0; i&lt;argc; i++)&#123; argv[i] = (char*)malloc(sizeof(char)*1024); strcpy(argv[i],[[commands objectAtIndex:i] UTF8String]); &#125; dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123; int rec = ffmpeg_main(argc, argv); for (int i=0;i&lt;argc;i++) free(argv[i]); free(argv); NSLog(@"rec = %i",rec); &#125;);&#125; æˆ‘å°±æ˜¯è¿™ä¹ˆå¹²çš„.å¦‚æžœä½ ç›´æŽ¥è¿™ä¹ˆå¹²å°±å‡ºé—®é¢˜äº†. ä½ ä¼šå‘çŽ°å‘½ä»¤ç¡®å®žå¯ä»¥è·‘èµ·æ¥, ä½†æ˜¯å®Œæ¯•äº†, appå°±è‡ªåŠ¨é€€å‡º.é—®é¢˜å‡ºåœ¨ cmdutils.c ä¸­çš„ exit_program() å‡½æ•°, å…¶ä¸­çš„ exit(ret) ä¸€è¡Œ.ffmpeg æ¯æ¬¡æ‰§è¡Œå‘½ä»¤æ—¶, éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹åŽ»æ‰§è¡Œ, å½“å‘½ä»¤æ‰§è¡Œå®Œæ¯•, å°±ä¼šè°ƒ exit_program() åšä¸€ç³»åˆ—çš„æ¸…ç†å·¥ä½œ, ç„¶åŽ exit(ret) ç›´æŽ¥æŠŠè¿›ç¨‹æ€æ­».macosä»¥åŠiOSçš„appéƒ½æ˜¯ä¸€èˆ¬æ¥è¯´éƒ½æ˜¯ä»¥å•è¿›ç¨‹çš„è®¾è®¡æ¦‚å¿µä¸ºä¸», å°¤å…¶æ˜¯éžè¶Šç‹±çš„ iOS æ›´æ˜¯æ²¡æœ‰å¤šè¿›ç¨‹çš„æ¦‚å¿µ, è¿™ä¹Ÿèƒ½è§£é‡Šäº†, ä¸ºä»€ä¹ˆå½“å‘½ä»¤æ‰§è¡Œå®Œæ¯•, appå°±è‡ªåŠ¨é€€å‡º. é‚£å°±å…ˆæ³¨é‡ŠæŽ‰ exit(ret) è¿™ä¸€è¡Œ, ä½¿å‘½ä»¤æ‰§è¡Œå®Œæ¯•, ä¹Ÿä¸ç”¨æ€æŽ‰è¿›ç¨‹.å†æ¬¡è¿è¡Œå‘½ä»¤ ffmpeg(å°±è¿™ä¸ªç®€å•çš„å‘½ä»¤è€Œå·²) , å‡ºé”™, ä¾ç¨€è®°å¾—æ˜¯ è®¿é—®äº†æŸä¸ªç©ºæ•°ç»„è¶Šç•Œçš„é”™è¯¯.åˆ†æžä¸€ä¸‹ ffmpeg.c ä¸­è¢«æ”¹åä¸º ffmpeg_main() çš„ main() å‡½æ•°,å¦‚å›¾:ç”±äºŽæˆ‘è¦æ±‚æ‰§è¡Œçš„å‘½ä»¤åªæ˜¯ç®€å•çš„ ffmpeg, æ‰€ä»¥å‡½æ•°æ‰§è¡Œåˆ°ä¸Šå›¾ä¸­ exit_program(1) å¤„å°±åº”è¯¥ç»“æŸ, å¦‚æžœ exit() é‚£ä¸€è¡Œä»£ç æ²¡æœ‰è¢«æ³¨é‡ŠæŽ‰, é‚£ä¹ˆ, æ ¹æœ¬ä¸å¯èƒ½ç»§ç»­æ‰§è¡Œä¸‹åŽ».é‚£ä¹ˆåŽŸå› å¤§æ¦‚å°±çŸ¥é“äº†.æ‰€ä»¥, æˆ‘å°† exit_program() å‡½æ•°ä¿®æ”¹äº†ä¸€ä¸‹(å¤´æ–‡ä»¶å’Œå®žçŽ°éƒ½è¦ä¿®æ”¹), æ”¹ä¸º:1234567int exit_program(int ret)&#123; if (program_exit) program_exit(ret);// exit(ret); return ret;&#125; å¹¶ä¸”åœ¨ ffmpeg() å‡½æ•°ä¸­çš„æ‰€æœ‰ exit_program(xxx) éƒ½æ”¹ä¸º return exit_program(xxx), ä½¿ ffmpeg() å‡½æ•°æ‰§è¡Œåˆ° exit_program(xxx) ç›´æŽ¥ç»“æŸ, ä¸å†å¾€ä¸‹èµ°. ä½†æ˜¯é—®é¢˜ä¾æ—§!!å³ä½¿æœ‰äº† return exit_program(xxx), å‡½æ•°è¿˜æ˜¯ç»§ç»­å¾€ä¸‹èµ°, ç™¾åº¦ä¸€ä¸‹, æ‰¾åˆ°äº†é—®é¢˜å‡ºçŽ°çš„åŽŸå› .åŽŸæ¥æ˜¯ cmdutils.h æ–‡ä»¶ä¸­ exit_program() å‡½æ•°æœ«å°¾çš„ av_noreturn ä¿®é¥°å¯¼è‡´ exit_program() å‡½æ•°è¢«åˆæ³•åœ°è®¤å®šä¸ºæ²¡æœ‰è¿”å›ž, æ‰€ä»¥å³ä½¿åœ¨å¤–éƒ¨è°ƒç”¨ return exit_program(xxx), éƒ½æ— æ³•æ­£å¸¸åœ°é€€å‡ºå‡½æ•°.av_noreturn çš„è¯¦ç»†è§£é‡Šè¯·å‚è€ƒ: ATTRIBUTE ä½ çŸ¥å¤šå°‘ï¼Ÿ é‚£ä¹ˆå‡ ä¹Žå¯ä»¥è®¤å®š, è¿™ä¸ª av_noreturn ä¿®é¥°, åªæ˜¯ä¸ºäº† exit() å‡½æ•°å­˜åœ¨è€ŒæœåŠ¡çš„, çŽ°åœ¨ exit() ä¸å­˜åœ¨äº†, é‚£æˆ‘å°±å¤§èƒ†æŠŠå®ƒåˆ æŽ‰äº†.åŽæ¥è¿˜æ ¹æ®é›·ç¥žçš„æç¤º, åœ¨ ffmpeg.c ä¸­ ffmpeg_cleanup() å‡½æ•°çš„æœ«å°¾ åŠ ä¸Šå„ç§å˜é‡çš„æ¸…é›¶æ“ä½œ:1234567nb_frames_dup = 0;nb_frames_drop = 0;nb_filtergraphs = 0;nb_input_files = 0;nb_input_streams = 0;nb_output_files = 0;nb_output_streams = 0; ç„¶åŽé¡ºåˆ©è¿è¡Œ. E.ä¸Šé¢æåˆ°äº†, æˆ‘éœ€è¦å‡†ç¡®åœ°æ•èŽ·åˆ°æ¯ä¸€ä¸ª ffmpeg çš„è¾“å‡ºæ—¥å¿—, å¹¶ä¸”å¯ä»¥å¥½åƒ Terminal æ‰§è¡Œ ffmpeg ä¸€æ ·è¾“å‡ºçš„æ—¥å¿—æ ¹æ®ä¸åŒçš„log_levelæ˜¾ç¤ºä¸åŒçš„é¢œè‰².å…·ä½“å¯ä»¥åŽ»çœ‹çœ‹ ffmpeg æºç ä¸­ libavutil/log.c æ˜¯æ€Žä¹ˆå®žçŽ° av_log() å‡½æ•°çš„, è¿™é‡Œç®€å•è¯´ä¸€ä¸‹, å¤§æ¦‚å°±æ˜¯ä½¿ç”¨ vsnprintf() ç»„åˆä¸€ä¸‹è¾“å‡ºçš„å­—ç¬¦ä¸², ç„¶åŽå†æ ¹æ®å‡½æ•°çš„å‚æ•° int level è®¾ç½®è¾“å‡ºçš„å­—ä½“é¢œè‰².å¦‚æžœæˆ‘ä»¬è¦æ’æ‰‹ av_log æ–¹æ³•æ¥è¾¾åˆ°éœ€æ±‚, é‚£ä¸ä»…ä»…éº»çƒ¦, è¿˜æ›´è¿›ä¸€æ­¥åœ°ç ´åäº† ffmpeg çš„åŽŸç”Ÿä»£ç , å…¶å®ž, ffmpeg æä¾›äº†ä¸€ä¸ª av_log_set_callback(void (*callback)(void*, int, const char*, va_list)) å‡½æ•°, åªè¦ä¼ å…¥ä¸€ä¸ª callback å‡½æ•°çš„åœ°å€, é‚£ä¹ˆè¯¥å‡½æ•°å°±ä¼šæŽ¥å—æ‰€æœ‰ av_log çš„å›žè°ƒ. 123456789101112void FFLogCallBackFunc(void *ptr, int level, const char *fmt, va_list vl)&#123; char o[1024]; vsnprintf(o, 1024, fmt, vl); NSString *output_desc = [NSString stringWithUTF8String:o]; NSLog(@"output_desc = %@\nlevel = %i",output_desc,level);&#125;int main(int argc, const char * argv[]) &#123; av_log_set_callback(&amp;FFLogCallBackFunc); return 0;&#125; F.ç›®å‰ä¸ºæ­¢, æ‰§è¡Œåª’ä½“æ ¼å¼é‡æ–°å°è£…, è·¨æ–‡ä»¶å°è£…æ–°çš„åª’ä½“æ–‡ä»¶, å¯¹éŸ³è§†é¢‘å­—å¹•æµçš„è½¬ç , å¯¹è§†éŸ³é¢‘å­—å¹•æµé‡æ–°é…ç½®ä¸€äº›åŸºç¡€çš„å‚æ•°ä¾‹å¦‚é‡‡æ ·çŽ‡æ¯”ç‰¹çŽ‡è§†é¢‘çš„scaleç­‰éƒ½æ²¡æœ‰ä»»ä½•é—®é¢˜. å¦‚é‡åˆ°ä»»ä½•é—®é¢˜, å°±åœ¨è¿™é‡Œç»§ç»­ GHIJKâ€¦]]></content>
      <tags>
        <tag>ffmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¶é‡.dylib]]></title>
    <url>%2F2018%2F04%2F24%2F%E5%81%B6%E9%81%87-dylib%2F</url>
    <content type="text"><![CDATA[ä»¥ä¸‹æ‰€è¯´çš„å¹¶ä¸æ˜¯ ffmpeg å¼•ç”¨åˆ°é¡¹ç›®ä¸­çš„æ­£ç¡®æ–¹æ³•, è¯·ä¸è¦æ¨¡ä»¿. ä¸€åˆ‡çš„ä¸€åˆ‡éƒ½è¦ä»Žç¼–è¯‘ ffmpeg, å¹¶åœ¨ mac os é¡¹ç›®ä¸Šå¼•ç”¨ ffmpeg è¯´èµ·. æˆ‘æ˜¯ç”¨çš„ homebrew è£…çš„ ffmpeg, è·¯å¾„æ˜¯ /usr/local/Cellar é‡Œé¢å‘æŒ¥ä¸»è¦ç”¨å¤„çš„æœ‰bin lib include ä¸‰ä¸ªæ–‡ä»¶, bin å­˜æ”¾æœ‰ ffmpeg, ffprobe ç­‰å¯æ‰§è¡Œæ–‡ä»¶, include éƒ½æ˜¯å¤´æ–‡ä»¶, lib é‡Œé¢æ”¾çš„å°±æ˜¯æˆ‘æ‰€å¶é‡çš„ä¸€å¤§å † .dylib ä»¥åŠ .a åº“æ–‡ä»¶. å› ä¸ºæƒ³è¦åšä¸ª ffmpeg ç»™è§†é¢‘è½¬ç çš„é¡¹ç›®, è¦å°† ffmpeg å¼•å…¥, åœ¨å¼•å…¥è¿™ä¸ªé˜¶æ®µ, æˆ‘èµ°äº†æ·å¾„, å¯ä»¥è¯´æ˜¯æ­ä¸Šäº†ç©¿æ¢­æœº(å…¶å®žæ˜¯ç‰¹å‚»ðŸ˜‚).æˆ‘ç›´æŽ¥ä»Ž /usr/local/Cellar æŠŠ lib include ä¸¤ä¸ªæ–‡ä»¶æ‹‰åˆ°é¡¹ç›®ä¸­, åœ¨é¡¹ç›®ä¸­ç”¨åˆ°äº† avformat avcodec ç­‰ç­‰çš„ç±», ä¸€åˆ‡çœ‹èµ·æ¥éƒ½éžå¸¸çš„é¡ºåˆ©, ç›´åˆ°æˆ‘ä»Ž ffmpeg 3.4 è½¬åˆ°äº† 4.0 ç‰ˆæœ¬â€¦æˆ‘é€šè¿‡ brew update &amp;&amp; $ brew reinstall ffmpeg --with-x265 å‘½ä»¤å°† ffmpeg å‡çº§åˆ° 4.0ç‰ˆæœ¬, å†æ‰“å¼€é¡¹ç›®, ä¸€è¿è¡Œå°±æŠ¥å¦‚ä¸‹é”™è¯¯:12dyld: Library not loaded: /usr/local/opt/ffmpeg/lib/libavdevice.58.dylib Reason: image not found æ€è€ƒä¸€ä¸‹, å¾ˆå¤§çš„åŽŸå› æ˜¯å‡ºåœ¨è¿™ä¸€å † .dylib åº“ä¸­. æŠ¥é”™ä¹Ÿè®©æˆ‘æ„Ÿåˆ°å¾ˆå¥‡æ€ª, æ˜Žæ˜Žå·²ç»å°†è¿™ä¸€å † .dylib æ”¾åˆ°é¡¹ç›®ä¸­, æ€Žä¹ˆ not loaded çš„è·¯å¾„ä¼šæ˜¯ /usr/local/opt/ffmpeg/lib/libavdevice.58.dylib ?? æˆ‘åˆ° DerivedData æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°äº†é¡¹ç›®ç”Ÿæˆçš„ .app æ–‡ä»¶, å‘çŽ°é‡Œé¢å¹¶æ²¡æœ‰ Frameworks æ–‡ä»¶å¤¹ä¹Ÿæ‰¾ä¸åˆ°ä»»ä½•æ‰“åŒ…è¿›åŽ» .app çš„ .dylib åº“.æ®æˆ‘æ‰€çŸ¥ç”±äºŽappleä¸ºäº†ç¦æ­¢çƒ­æ›´æ–°çš„å…³ç³», åŠ¨æ€åº“åªèƒ½é€šè¿‡ Embedded binaries åµŒå…¥å¼åŠ¨æ€åº“æ‰“å…¥åˆ° .app ä¸­, æˆ‘ä¸€æ‹å¤§è…¿ä»¥ä¸ºè‡ªå·±å·²ç»æ‰¾åˆ°äº†è§£å†³é—®é¢˜çš„åŠžæ³•, èµ¶ç´§å°†æ‰€æœ‰ .dylib æ–‡ä»¶åŠ å…¥åˆ°Embedded binariesä¸­. ç„¶è€Œå¹¶æ²¡æœ‰ä»€ä¹ˆæ’šç”¨â€¦æˆ‘å†…å¿ƒä¸€ç›´åœ¨è®¤ä¸º, è¿™ä¸ª .dylib ä¸ç®€å•, é‡Œé¢ä¸€å®šæœ‰ä»€ä¹ˆä½¿appåœ¨è¿è¡Œçš„æ—¶å€™æŒ‡å‘é‚£ä¸ªæˆ‘ä¸æƒ³æŒ‡å‘çš„åœ°æ–¹: /usr/local/opt/ffmpeg/.åœ¨ä¸€ç•ªgoogleè¿‡åŽ, è¿™ä¸¤ç¯‡æ–‡ç« å¸®äº†æˆ‘çš„å¤§å¿™: MacOSå¹³å°ä¸‹@rpathåœ¨åŠ¨æ€é“¾æŽ¥åº“ä¸­çš„åº”ç”¨Macä¸‹åŠ¨æ€åº“çš„install_name å…¶ä¸­æ–‡ç«  Macä¸‹åŠ¨æ€åº“çš„install_name è¯¦ç»†åœ°æŒ‡å‡ºäº† install name åœ¨ .dylib çš„ä½œç”¨.æˆ‘ä¹Ÿç”¨ otool -D /æˆ‘çš„appåŒ…/content/Frameworks/libavdevice.58.dylib æŸ¥çœ‹äº† libavdevice.58.dylib çš„ install name, æ˜¯æŒ‡å‘ç€ /usr/local/opt/ffmpeg/lib/libavdevice.58.dylib, è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆä¸Šé¢çš„æŠ¥é”™è·¯å¾„ä¼šæ˜¯è¿™ä¸ª.é‚£ä¹ˆè§£å†³é—®é¢˜çš„åŠžæ³•å°±æ˜¯, ä½¿ .dylib åŒ…çš„ install name æŒ‡å‘æ­£ç¡®çš„è·¯å¾„(é€šä¿—è§£é‡Š, å¦‚æœ‰ä¸å¯¹æ„Ÿè°¢æŒ‡å‡º).ä»¥å…¶ä¸­ä¸€ä¸ª .dylib ä¸ºä¾‹, ä½¿ç”¨å‘½ä»¤1$ install_name_tool -id @rpath/libavdevice.58.dylib æˆ‘çš„é¡¹ç›®è·¯å¾„/lib/libavdevice.58.dylib å°±å°† libavdevice.58.dylib çš„ install name ä¿®æ”¹ä¸º @rpath/libavdevice.58.dylib, è€Œä¸”è¿™ä¸ªä»¥ @rpath ä¿®é¥°çš„ install name é’ˆå¯¹å„ä¸ªå¼•ç”¨è¿™ä¸ª .dylib åº“çš„é¡¹ç›®è€Œè¨€æ˜¯ åŠ¨æ€çš„ &amp;&amp; æ˜¯ç”±é¡¹ç›®çš„ run path å†³å®šçš„, å¯¹äºŽ @rpath @loader_path @executable_path çš„åŒºåˆ«, å…·ä½“è¯·çœ‹ MacOSå¹³å°ä¸‹@rpathåœ¨åŠ¨æ€é“¾æŽ¥åº“ä¸­çš„åº”ç”¨. ä¸Šé¢æåˆ°äº† ä»¥ @rpath ä¿®é¥°çš„ install name æ˜¯ç”±é¡¹ç›®çš„ run path å†³å®šçš„ é‚£ä¹ˆæˆ‘è¿˜éœ€è¦åœ¨é¡¹ç›®é‡Œ Build Settings ä¸­ Runpath search paths é‡Œé¢åŠ å…¥æˆ‘å°†å†³å®šè¿™äº›å¼•å…¥çš„ .dylib åº“çœŸæ­£å®Œæ•´çš„ install name è¿˜æœ‰æ›´æ¶å¿ƒäººçš„,lib æ–‡ä»¶å¤¹é‡Œé¢æœ‰åå‡ ä¸ªè¿™æ ·çš„ .dylib åº“, è¿™æ„å‘³ç€, æˆ‘è¦é‡å¤è¿™ä¸ª $ install_name_tool -id @rpath/libavdevice.58.dylib æˆ‘çš„é¡¹ç›®è·¯å¾„/lib/libavdevice.58.dylib å‘½ä»¤åå‡ æ¬¡â€¦ æˆ‘è¿˜ä¸€åº¦æƒ³è¦å†™ä¸ª python è„šæœ¬æ¥å®Œæˆæ‰§è¡Œè¿™ä¸ªå‘½ä»¤åå‡ æ¬¡çš„ä»»åŠ¡, å°½ç®¡æˆ‘å‚», ä½†æ˜¯å¹¶æ²¡è‡³äºŽå¦‚æ­¤. é™æ€ç¼–è¯‘ ffmpeg æ‰æ˜¯å‡ºè·¯, å½“ç„¶è¿™ä¹Ÿæ˜¯åŽè¯äº†. ç§‰æ‰¿ç€ å®žè·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€é“è·¯ è¿™ä¸€æ·±æ·±å°åœ¨æˆ‘å¿ƒä¸­çš„ç†å¿µ, æˆ‘æ‰‹åŠ¨..äººè‚‰..äº²è‡ªæ‰§è¡Œäº†è¿™ä¸ªå‘½ä»¤åå‡ æ¬¡, å°†åœ¨é¡¹ç›®ä¸­ lib æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰çš„ .dylib çš„ install name éƒ½æ‰§è¡Œäº†ä¸€æ¬¡, å¹¶ä¸” brew uninstall ffmpeg åˆ é™¤äº†æœ¬åœ°çš„ ffmpeg ä»¥ç¡®ä¿ä¸ä¼šå¹²æ‰°åˆ°æˆ‘è¿™ä¸ªæ— èŠçš„å®žéªŒ. è¿è¡Œé¡¹ç›®, ä¸å†æŠ¥é”™, ffmpegä½¿ç”¨æ­£å¸¸, ä½¿ç”¨ otool -D å‘½ä»¤æ£€æŸ¥ .app åŒ…åŒ…é‡Œ /Frameworks é‡Œé¢ .dylib åº“çš„ install name ç¡®å®žæŒ‡å‘äº†å¦‚æˆ‘æ‰€æ„¿çš„ä½ç½®.DONE.. èƒ½å¤Ÿè®¤è¯†åˆ° .dylib, äººè‚‰æ‰§è¡Œåå‡ æ¬¡é‚£ä¸ªä¿®æ”¹ install name çš„å‘½ä»¤, ä¹Ÿæ˜¯å€¼å¾—.]]></content>
      <tags>
        <tag>ffmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æˆ‘æ˜¯æˆ¿ä¸œ-é¡¹ç›®ä»‹ç»]]></title>
    <url>%2F2017%2F11%2F15%2F%E6%88%91%E6%98%AF%E6%88%BF%E4%B8%9C-%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D%2F</url>
    <content type="text"><![CDATA[æˆ‘æ˜¯æˆ¿ä¸œ - æ™ºèƒ½çš„æˆ¿ä¸œç§Ÿèµæ•°æ®ç®¡ç†åˆ©å™¨æ— å¹¿å‘Šï¼Œæ— æŽ¨èä¿¡æ¯ï¼Œçº¯å‡€ï¼Œé«˜æ•ˆï¼Œè´´å¿ƒï¼Œéžå•†ä¸šåŒ–çš„æˆ¿ä¸œç§Ÿèµæ•°æ®ç®¡ç†appï¼Œè§£æ”¾æ‚¨æ‰‹ä¸­çš„çº¸ï¼Œç¬”å’Œä¼ ç»Ÿçš„è®¡ç®—å™¨ï¼Œè®©æ‚¨æœ‰æ›´å¤šæ—¶é—´åŽ»äº«å—è¯—å’Œè¿œæ–¹ï¼[ç®€å•ç›´è§‚çš„ç•Œé¢] é€šè¿‡å¤šæ¬¡çš„å°è¯•å’ŒæŽ¢ç´¢ï¼Œä¸€å¿ƒè¦åˆ¶å®šæœ€ç®€å•è€Œåˆç›´è§‚çš„ä½¿ç”¨ç•Œé¢ï¼Œä½¿æˆ‘æ˜¯æˆ¿ä¸œå°½å¯èƒ½æ›´æ˜“ä½¿ç”¨ï¼Œè®©ç”¨æˆ·ä½¿ç”¨å¾—å¿ƒåº”æ‰‹ã€‚ [æ— å¹¿å‘Šæ— æŽ¨è] æ— å¹¿å‘Šï¼Œæ— ä¸å¿…è¦çš„â€œå‘çŽ°â€ç­‰å†…å®¹ï¼Œç®€å•é«˜æ•ˆã€‚ [é«˜åº¦å¯å®šåˆ¶] å„ç±»ä¿¡æ¯é«˜åº¦å¯å®šåˆ¶ï¼Œå›´ç»•ç‰©ä¸šï¼Œæˆ¿é—´ï¼Œç§Ÿå®¢ï¼Œæ”¶è´¹é¡¹ç›®å®šåˆ¶æ‚¨çš„ç§Ÿèµæ•°æ®ã€‚æˆ¿é—´åˆåŒæœŸè®°å½•ï¼ŒæŠ¼é‡‘è®°å½•ã€‚å°¤å…¶æ˜¯é’ˆå¯¹ç‰©ä¸šçš„æ”¶è´¹é¡¹ç›®ï¼Œæ‚¨éœ€è¦ä»€ä¹ˆæ”¶è´¹é¡¹ç›®ï¼Œç”±æ‚¨æŽŒæ¡ã€‚ [é«˜æ•ˆæ™ºèƒ½çš„ç»Ÿè®¡æ–¹å¼] æ”¶è´¹é¡¹ç›®å¯æŒ‡å®šåˆ°ç›®æ ‡æˆ¿é—´ï¼ŒæŠ„è¡¨ç»Ÿè®¡è´¹ç”¨æˆ–ç”¨é‡æ—¶å¯ç›´æŽ¥è¾“å…¥é¡¹ç›®è¯»æ•°æˆ–ç”¨é‡ï¼Œå³ä½¿æ°´ç”µè¡¨è·‘åˆ°ç½®é›¶ï¼Œä¹Ÿä¸å¿…æ‹…å¿ƒæ•°æ®æœ‰è¯¯ã€‚æŠ„è¡¨æ—¶appä¼šè‡ªåŠ¨è®¾ç½®æˆ–ç”±ç”¨æˆ·è‡ªç”±é€‰æ‹©ä¸Šæœˆè¯»æ•°åˆ°æœ¬æœˆæŠ„è¡¨æ•°æ®ä¸­ï¼Œé«˜æ•ˆè´´å¿ƒï¼Œç”¨æˆ·æ”¾å¿ƒã€‚ [èº«ä»½è¯æ‰«æ] è®°å½•ç§Ÿæˆ¿äººä¿¡æ¯æ—¶ï¼Œå¯é€šè¿‡æ‰«æèº«ä»½è¯æˆ–è¯†åˆ«èº«ä»½è¯å›¾ç‰‡æ¥å¿«é€Ÿå½•å…¥èº«ä»½è¯ä¿¡æ¯ã€‚ [è´´å¿ƒæé†’] è¯¥æŠ„è¡¨äº†ï¼ŒæŠ„è¡¨åŽè‹¥å¹²æ—¥è¿‡åŽ»äº†æœ‰ç§Ÿæˆ·è¿˜æ²¡ç¼´ç§Ÿï¼Œæˆ‘æ˜¯æˆ¿ä¸œæ¥æé†’ä½ ã€‚ [éšç§ä¿æŠ¤] è¿›å…¥åŽå°å³æ¨¡ç³Šç•Œé¢ï¼Œè¿›å…¥appå¯†ç ç”±æ‚¨æ¥å®šã€‚ [è°¨æ…Žå¯¹å¾…æ•°æ®] åˆ é™¤æ“ä½œç­‰éƒ½éœ€è¦éªŒè¯é‰´å®šï¼Œå‡å°‘è¯¯æ“ä½œæ•°æ®ã€‚ [å¼ºå¤§çš„æœ¬åœ°æœç´¢åŠŸèƒ½] æƒ³æ‰¾æ‰¾åä¸ºâ€œæŽå››â€çš„ç§Ÿèµä¿¡æ¯æˆ–æˆ¿é—´ï¼Ÿåˆ°æœç´¢æ è¾“å…¥æ‚¨æƒ³è¦çš„ï¼Œå°±èƒ½æ‰¾åˆ°ä½ æƒ³è¦çš„ã€‚ [æ™ºèƒ½çš„æ‰“å°åŠŸèƒ½] åªè¦æ‚¨é…å¤‡äº†æ”¯æŒ AirPrint çš„æ‰“å°æœºï¼Œåˆ©ç”¨ æˆ‘æ˜¯æˆ¿ä¸œï¼Œå°±èƒ½è½»æ¾æ‰“å°æ‚¨æƒ³æ‰“å°çš„ç§Ÿèµæ•°æ®ã€‚]]></content>
      <categories>
        <category>iOSé¡¹ç›®-æˆ‘æ˜¯æˆ¿ä¸œ</category>
      </categories>
      <tags>
        <tag>iOS</tag>
        <tag>æˆ‘æ˜¯æˆ¿ä¸œ</tag>
      </tags>
  </entry>
</search>
